name: Database Migration Update

on:
  push:
    branches: [ "master" ]

jobs:
  rerun-docker-compose:
    runs-on: self-hosted
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Install dotnet
        run: |
          wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh
          chmod +x ./dotnet-install.sh
          ./dotnet-install.sh --channel 9.0
          ./dotnet-install.sh --channel 9.0 --runtime aspnetcore
          export DOTNET_ROOT=$HOME/.dotnet
          export PATH=$PATH:$HOME/.dotnet

      - name: Execute database migration
        run: |
          cd Backend
          source /home/waldo/.bashrc
          dotnet ef migrations add ${{ github.sha }} --project Database --startup-project Backend.Api
